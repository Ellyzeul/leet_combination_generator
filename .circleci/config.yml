version: 2.1


jobs:
  build:
    docker:
        - image: cimg/php:8.0
        - image: cimg/mysql:8.0
    working_directory:  ~/project
    steps:
      - checkout
      - run:
          name: "Setting up MySQL"
          command:
            sudo apt install mysql-server;
            sudo mysql -e "CREATE USER 'homestead'@'localhost' IDENTIFIED BY 'secret';CREATE DATABASE homestead;"
      - run:
          name: "Cloning repo"
          command:
            git clone https://github.com/Ellyzeul/leet_combination_generator.git;
      - run:
          name: "Setting up Composer"
          command:
            cd /home/circleci/project/leet_combination_generator;
            composer install -n --prefer-dist
      - run:
          name: "Setting up migrations"
          command:
            cd /home/circleci/project/leet_combination_generator;
            php artisan migrate:fresh --seed --force --env=production --no-interaction -vvv
      - run:
          name: "Run Tests"
          command:
            cd /home/circleci/project/leet_combination_generator;
            ./vendor/bin/phpunit